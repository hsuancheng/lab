---
import pubs from "../content/publications.json";

// Use pubs directly to preserve order
const sortedPubs = [...pubs];

// Group by year preserving order (linear scan)
const yearGroups = [];
let currentGroup = null;

sortedPubs.forEach((p) => {
  const y = String(p.year);
  if (!currentGroup || currentGroup.year !== y) {
    currentGroup = { year: y, list: [] };
    yearGroups.push(currentGroup);
  }
  currentGroup.list.push(p);
});

// Calculate continuous numbering
let globalCount = 1;
yearGroups.forEach((g) => {
  g.start = globalCount;
  globalCount += g.list.length;
});
---

<section style="margin-bottom: 2.5rem;">
  {yearGroups.map(({ year, list, start }) => (
    <div style="margin-bottom: 1.5rem;">
      <h2 style="font-size: 1.3rem; margin-bottom: 0.5rem;">{year}</h2>
      <ol start={start} style="margin: 0; padding-left: 1.2rem; font-size: 0.9rem;">
        {list.map((p) => (
          <li style="margin-bottom: 0.4rem;">
            <span>{p.authors}. </span>
            <span style="font-weight: 600;">{p.title}. </span>
            <span>{p.venue}.</span>

            {p.note && <span> ({p.note})</span>}
          </li>
        ))}
      </ol>
    </div>
  ))}
</section>
